openapi: 3.1.0
info:
  title: Aletheia Deep Research API
  description: "\n    ## \U0001F50D API para análisis e investigación profunda\n \
    \   \n    Esta API proporciona capacidades avanzadas de investigación utilizando:\n\
    \    \n    - **Investigación Iterativa**: Búsqueda profunda con múltiples iteraciones\n\
    \    - **Procesamiento Paralelo**: Optimizado para alto rendimiento\n    - **Trazabilidad\
    \ Completa**: Monitoreo y observabilidad con OpenTelemetry\n    - **Múltiples\
    \ Fuentes**: Integración con Tavily y Saptiva APIs\n    \n    ### \U0001F4CB Casos\
    \ de Uso\n    \n    - Análisis de mercado y competencia\n    - Investigación académica\
    \ y científica  \n    - Due diligence empresarial\n    - Monitoreo de tendencias\n\
    \    \n    ### \U0001F680 Características\n    \n    - ✅ Auto-escalado en Kubernetes\n\
    \    - ✅ CI/CD enterprise-grade\n    - ✅ Seguridad y compliance\n    - ✅ Métricas\
    \ de calidad\n    "
  contact:
    name: Aletheia Development Team
    url: https://github.com/saptiva-ai/alethia_deepresearch
    email: dev@saptiva.ai
  license:
    name: MIT License
    url: https://opensource.org/licenses/MIT
  version: 0.7.0
paths:
  /health:
    get:
      tags:
      - health
      summary: Estado del sistema
      description: Verifica el estado de salud de la API y la disponibilidad de servicios
        externos
      operationId: health_check_health_get
      responses:
        '200':
          description: Sistema funcionando correctamente
          content:
            application/json:
              schema: {}
              example:
                status: healthy
                service: Aletheia Deep Research API
                version: 0.7.0
                api_keys:
                  saptiva_available: true
                  tavily_available: true
                cached: false
                timestamp: 1726179600.0
  /research:
    post:
      tags:
      - research
      summary: Iniciar investigación estándar
      description: "Inicia una nueva tarea de investigación con procesamiento paralelo\
        \ optimizado.\n    \n    - **Procesamiento asíncrono**: La investigación se\
        \ ejecuta en segundo plano\n    - **Optimización paralela**: Múltiples sub-tareas\
        \ ejecutadas simultáneamente  \n    - **Múltiples fuentes**: Integración con\
        \ Tavily y Saptiva APIs\n    - **Alta disponibilidad**: Continúa funcionando\
        \ aunque algunas APIs no estén disponibles"
      operationId: start_research_research_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResearchRequest'
        required: true
      responses:
        '202':
          description: Tarea de investigación aceptada y en ejecución
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskStatus'
              example:
                task_id: 550e8400-e29b-41d4-a716-446655440000
                status: accepted
                details: Research task has been accepted and is running with optimized
                  parallel processing.
        '400':
          description: Parámetros de solicitud inválidos
        '500':
          description: Error interno del servidor
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /tasks/{task_id}/status:
    get:
      tags:
      - tasks
      summary: Consultar estado de tarea
      description: Obtiene el estado actual de una tarea de investigación específica
      operationId: get_task_status_tasks__task_id__status_get
      parameters:
      - name: task_id
        in: path
        required: true
        schema:
          type: string
          title: Task Id
      responses:
        '200':
          description: Estado de la tarea recuperado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskStatus'
              example:
                task_id: 550e8400-e29b-41d4-a716-446655440000
                status: completed
                details: Research completed with 15 evidence sources
        '404':
          description: Tarea no encontrada
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /reports/{task_id}:
    get:
      tags:
      - reports
      summary: Obtener reporte de investigación
      description: Recupera el resultado completo de una tarea de investigación incluyendo
        el reporte y fuentes
      operationId: get_report_reports__task_id__get
      parameters:
      - name: task_id
        in: path
        required: true
        schema:
          type: string
          title: Task Id
      responses:
        '200':
          description: Reporte recuperado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'
              example:
                status: completed
                report_md: '# Análisis del Mercado de IA en 2025


                  ## Resumen Ejecutivo

                  ...'
                sources_bib: Generated from 15 evidence sources
                metrics_json: '{"mock_metric": 1.0}'
        '404':
          description: Reporte no encontrado
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /traces/{task_id}:
    get:
      tags:
      - observability
      summary: Obtener trazas de observabilidad
      description: "Recupera artefactos de trazabilidad y observabilidad para una\
        \ tarea específica.\n    \n    Incluye:\n    - **Manifiesto**: Configuración\
        \ y metadatos de la ejecución\n    - **Eventos**: Log de eventos en formato\
        \ NDJSON para análisis\n    - **OpenTelemetry**: Trazas de rendimiento y monitoreo"
      operationId: get_traces_traces__task_id__get
      parameters:
      - name: task_id
        in: path
        required: true
        schema:
          type: string
          title: Task Id
      responses:
        '200':
          description: Trazas recuperadas exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Traces'
              example:
                manifest_json: '{"version": "0.7.0", "task_type": "research", "started_at":
                  "2025-09-12T10:00:00Z"}'
                events_ndjson: '{"event": "task_started", "timestamp": "2025-09-12T10:00:00Z"}

                  {"event": "plan_created", "subtasks": 5}'
                otel_export_json: '{"trace_id": "abc123", "spans": [{"name": "research_task",
                  "duration_ms": 1250}]}'
        '404':
          description: Tarea no encontrada
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /deep-research:
    post:
      tags:
      - deep-research
      summary: Iniciar investigación profunda iterativa
      description: "Inicia una investigación profunda usando el patrón Together AI\
        \ con refinamiento iterativo.\n    \n    ### \U0001F504 Características de\
        \ Deep Research:\n    - **Refinamiento iterativo**: Múltiples ciclos de análisis\
        \ y mejora\n    - **Score de completitud**: Evaluación automática de calidad\n\
        \    - **Gap analysis**: Identificación automática de brechas de información\n\
        \    - **Control de presupuesto**: Límites configurables de recursos\n   \
        \ \n    ### \U0001F4CA Métricas de Calidad:\n    - Completion level (0.0 -\
        \ 1.0)\n    - Research quality score \n    - Evidence count tracking\n   \
        \ - Execution time monitoring"
      operationId: start_deep_research_deep_research_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeepResearchRequest'
        required: true
      responses:
        '202':
          description: Tarea de investigación profunda aceptada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskStatus'
              example:
                task_id: deep-550e8400-e29b-41d4-a716-446655440000
                status: accepted
                details: 'Deep research task accepted with parallel processing. Configuration:
                  5 iterations, 0.85 min score.'
        '400':
          description: Parámetros de configuración inválidos
        '500':
          description: Error interno del servidor
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /deep-research/{task_id}:
    get:
      tags:
      - deep-research
      summary: Obtener reporte de investigación profunda
      description: "Recupera el resultado completo de una investigación profunda incluyendo\
        \ métricas de calidad.\n    \n    ### \U0001F4CA Contenido del Reporte:\n\
        \    - **Reporte final**: Documento completo en Markdown\n    - **Resumen\
        \ de investigación**: Estructura de datos con hallazgos clave\n    - **Métricas\
        \ de calidad**: Scores de completitud y evidencia\n    - **Bibliografia**:\
        \ Referencias de todas las fuentes consultadas"
      operationId: get_deep_research_report_deep_research__task_id__get
      parameters:
      - name: task_id
        in: path
        required: true
        schema:
          type: string
          title: Task Id
      responses:
        '200':
          description: Reporte de investigación profunda recuperado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeepResearchReport'
              example:
                status: completed
                report_md: '# Impacto de AI Act en Startups Europeas


                  ## Análisis Profundo

                  ...'
                sources_bib: Generated from 42 evidence sources
                research_summary:
                  iterations_completed: 3
                  gaps_identified:
                  - regulatory_compliance
                  - market_impact
                  key_findings:
                  - High compliance costs
                  - Market consolidation likely
                quality_metrics:
                  completion_level: 0.95
                  quality_score: 0.88
                  evidence_count: 42
                  execution_time: 127.3
        '404':
          description: Tarea de investigación profunda no encontrada
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
components:
  schemas:
    DeepResearchReport:
      properties:
        status:
          type: string
          title: Status
          description: Estado del reporte
          example: completed
        report_md:
          anyOf:
          - type: string
          - type: 'null'
          title: Report Md
          description: Contenido del reporte final en Markdown
        sources_bib:
          anyOf:
          - type: string
          - type: 'null'
          title: Sources Bib
          description: Bibliografía de fuentes consultadas
        research_summary:
          anyOf:
          - type: object
          - type: 'null'
          title: Research Summary
          description: Resumen estructurado de la investigación
        quality_metrics:
          anyOf:
          - type: object
          - type: 'null'
          title: Quality Metrics
          description: Métricas de calidad de la investigación
          example:
            completion_level: 0.95
            evidence_count: 42
            execution_time: 127.3
            quality_score: 0.88
      type: object
      required:
      - status
      title: DeepResearchReport
      description: Reporte de investigación profunda con métricas de calidad.
    DeepResearchRequest:
      properties:
        query:
          type: string
          title: Query
          description: Consulta principal de investigación profunda
          example: Impacto de la regulación AI Act en startups europeas
        scope:
          anyOf:
          - type: string
          - type: 'null'
          title: Scope
          description: Alcance específico de la investigación
          example: startup_ecosystem_europa
        max_iterations:
          anyOf:
          - type: integer
            maximum: 10.0
            minimum: 1.0
          - type: 'null'
          title: Max Iterations
          description: Máximo número de iteraciones de refinamiento
          default: 3
          example: 5
        min_completion_score:
          anyOf:
          - type: number
            maximum: 1.0
            minimum: 0.1
          - type: 'null'
          title: Min Completion Score
          description: Score mínimo de completitud para finalizar
          default: 0.75
          example: 0.85
        budget:
          anyOf:
          - type: integer
            maximum: 5000.0
            exclusiveMinimum: 0.0
          - type: 'null'
          title: Budget
          description: Presupuesto total para la investigación
          default: 100
          example: 200
      type: object
      required:
      - query
      title: DeepResearchRequest
      description: Solicitud para investigación iterativa profunda usando patrón Together
        AI.
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError
    Report:
      properties:
        status:
          type: string
          title: Status
          description: Estado del reporte
          example: completed
        report_md:
          anyOf:
          - type: string
          - type: 'null'
          title: Report Md
          description: Contenido del reporte en Markdown
        sources_bib:
          anyOf:
          - type: string
          - type: 'null'
          title: Sources Bib
          description: Bibliografía de fuentes consultadas
          example: Generated from 15 evidence sources
        metrics_json:
          anyOf:
          - type: string
          - type: 'null'
          title: Metrics Json
          description: Métricas de calidad en formato JSON
      type: object
      required:
      - status
      title: Report
      description: Reporte de investigación estándar.
    ResearchRequest:
      properties:
        query:
          type: string
          title: Query
          description: Consulta de investigación
          example: Análisis del mercado de inteligencia artificial en 2025
        scope:
          anyOf:
          - type: string
          - type: 'null'
          title: Scope
          description: Alcance específico de la investigación
          example: mercado_latinoamericano
        budget:
          anyOf:
          - type: number
            maximum: 1000.0
            exclusiveMinimum: 0.0
          - type: 'null'
          title: Budget
          description: Presupuesto máximo para fuentes de datos
          example: 50.0
      type: object
      required:
      - query
      title: ResearchRequest
      description: Solicitud para investigación estándar con procesamiento paralelo
        optimizado.
    TaskStatus:
      properties:
        task_id:
          type: string
          title: Task Id
          description: Identificador único de la tarea
          example: 550e8400-e29b-41d4-a716-446655440000
        status:
          type: string
          title: Status
          description: Estado actual de la tarea
          example: completed
        details:
          anyOf:
          - type: string
          - type: 'null'
          title: Details
          description: Detalles adicionales del estado
          example: Investigación completada con 15 fuentes
      type: object
      required:
      - task_id
      - status
      title: TaskStatus
      description: Estado de una tarea de investigación.
    Traces:
      properties:
        manifest_json:
          type: string
          title: Manifest Json
          description: Manifiesto de la ejecución
        events_ndjson:
          type: string
          title: Events Ndjson
          description: Eventos de trazabilidad en formato NDJSON
        otel_export_json:
          type: string
          title: Otel Export Json
          description: Exportación de trazas OpenTelemetry
      type: object
      required:
      - manifest_json
      - events_ndjson
      - otel_export_json
      title: Traces
      description: Artefactos de trazabilidad y observabilidad.
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError
tags:
- name: health
  description: Endpoints de estado y monitoreo del sistema
- name: research
  description: Investigación estándar con procesamiento paralelo optimizado
- name: deep-research
  description: Investigación iterativa profunda usando patrón Together AI
- name: tasks
  description: Gestión y seguimiento de tareas de investigación
- name: reports
  description: Generación y recuperación de reportes
- name: observability
  description: Trazabilidad y métricas de rendimiento
